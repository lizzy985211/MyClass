import{h as k,d as B,u as N,i as T,w as V,c as g,a as t,t as i,F as $,e as E,l as F,o as h}from"./index-DXsCtUvq.js";const K={class:"card"},O={class:"row",style:{"justify-content":"space-between","margin-bottom":"8px"}},M={class:"row"},P={class:"table"},A={__name:"ClassListView",setup(q){const o=N(),d=k(null),a=k("default"),l=k("desc"),R=B(()=>a.value==="default"?"降序排序":a.value==="score"&&l.value==="desc"?"升序排序":a.value==="score"&&l.value==="asc"?"默认排序":"排序");async function x(){const n=o.params.school;d.value=await F(n)}const j=B(()=>{var y,C,L,w;if(!d.value)return[];const n=o.params.grade,e=o.params.klass,s=o.params.subject,f=o.params.examTab,r=(w=(L=(C=(y=d.value)==null?void 0:y.data)==null?void 0:C[n])==null?void 0:L[e])==null?void 0:w[s];if(!r)return[];let u=f==="points"?r.pointList||[]:r.examList||[];if(a.value==="default")return[...u].sort((p,b)=>Number((p.id||"").toString().replace(/\D/g,""))-Number((b.id||"").toString().replace(/\D/g,"")));const c=a.value,m=l.value;return[...u].sort((p,b)=>{const S=p[c],D=b[c];return S===D?0:(S>D?1:-1)*(m==="asc"?1:-1)})});function U(){a.value==="default"?(a.value="score",l.value="desc"):a.value==="score"&&l.value==="desc"?l.value="asc":(a.value="default",l.value="desc")}function v(n){if(n==="rank"){a.value="rank",l.value="asc";return}a.value===n?l.value=l.value==="asc"?"desc":"asc":(a.value=n,l.value=n==="score"?"desc":"asc")}function _(){const n=["name","id","gender","score","rank","date"],e=j.value.map(c=>n.map(m=>c[m]??"")),s=[n.join(","),...e.map(c=>c.join(","))].join(`
`),f=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(f),u=document.createElement("a");u.href=r,u.download="class-list.csv",u.click(),URL.revokeObjectURL(r)}return T(x),V(()=>o.fullPath,x),(n,e)=>(h(),g("div",K,[t("div",O,[e[3]||(e[3]=t("div",{class:"row"},[t("strong",null,"班级成绩列表")],-1)),t("div",M,[t("button",{onClick:U},i(R.value),1),t("button",{class:"primary",onClick:_},"一键导出 CSV")])]),t("table",P,[t("thead",null,[t("tr",null,[t("th",{onClick:e[0]||(e[0]=s=>v("name"))},"姓名"),e[4]||(e[4]=t("th",null,"性别",-1)),t("th",{onClick:e[1]||(e[1]=s=>v("score"))},"分数"),t("th",{onClick:e[2]||(e[2]=s=>v("rank"))},"名次"),e[5]||(e[5]=t("th",null,"考试时间",-1))])]),t("tbody",null,[(h(!0),g($,null,E(j.value,s=>(h(),g("tr",{key:s.id},[t("td",null,i(s.name),1),t("td",null,i(s.gender),1),t("td",null,i(s.score),1),t("td",null,i(s.rank),1),t("td",null,i(s.date),1)]))),128))])])]))}};export{A as default};

import{_ as it,d as _,u as ct,k as ut,h as l,i as dt,w as ft,c as R,a,j as v,v as z,m as N,F as pt,e as mt,p as ht,o as $,n as vt,t as S}from"./index-DXsCtUvq.js";import{i as gt}from"./index-Bb6yjXMn.js";/* empty css                                                                   */const yt={class:"card"},Ct={class:"chart-container"},bt={class:"controls"},kt={class:"control-group"},_t={class:"control-group"},St={class:"controls"},xt={class:"control-group"},Bt={id:"students-wrapper"},wt={id:"students"},Lt=["data-id"],Mt={class:"rank-label"},Tt=["src"],At={class:"info-line"},It=["id"],Rt={class:"btn-group"},Nt=["onClick"],$t=["onClick"],Et=["onClick"],Ot=["onClick"],jt={__name:"PointsView",props:{activeTab:{type:String,default:"number"}},setup(H){const E=H,g=ct(),O=_(()=>`points:${g.params.school}:${g.params.grade}:${g.params.klass}`),x=["Class 68","Class 69"],n=ut({studentsByClass:{},currentClass:x[0],searchKeyword:""}),f=l(""),p=l(""),B=l("男"),w=l(null),j=l(null),D=l(null),V=l(null),U=l(null),L=l("");let M;const q=_({get:()=>n.currentClass,set:e=>n.currentClass=e}),F=_({get:()=>n.searchKeyword,set:e=>n.searchKeyword=e}),J=["赵","钱","孙","李","周","吴","郑","王","冯","陈","褚","卫","蒋","沈","韩","杨"],K=["浩然","梓涵","子轩","宇轩","浩宇","怡然","子墨","语桐","欣怡","语汐","子萱","梓萱","雨桐","子涵","诗涵","晨曦","昊然","俊熙","思涵","沐辰"],y=["https://i.pravatar.cc/50?img=1","https://i.pravatar.cc/50?img=2","https://i.pravatar.cc/50?img=3","https://i.pravatar.cc/50?img=4","https://i.pravatar.cc/50?img=5","https://i.pravatar.cc/50?img=6"];function Z(){const e={};return x.forEach(s=>{e[s]=[];for(let t=0;t<60;t++)e[s].push({id:String(t+1).padStart(2,"0"),name:J[Math.floor(Math.random()*J.length)]+K[Math.floor(Math.random()*K.length)],gender:Math.random()>.5?"男":"女",score:Math.floor(Math.random()*21),avatar:y[Math.floor(Math.random()*y.length)],rank:t+1})}),e}const G=_(()=>{const e=n.studentsByClass[n.currentClass]||[];return E.activeTab==="score"?e.slice().sort((s,t)=>t.score-s.score||Number(s.id)-Number(t.id)):e.slice().sort((s,t)=>Number(s.id)-Number(t.id))});function P(){try{const e=localStorage.getItem(O.value);if(e)return JSON.parse(e)}catch{}return Z()}function m(){localStorage.setItem(O.value,JSON.stringify(n.studentsByClass))}function X(){i(n.studentsByClass[n.currentClass])}function Q(){if(!f.value||!p.value)return;const e=n.studentsByClass[n.currentClass];e.push({id:p.value,name:f.value,gender:B.value,score:0,avatar:y[Math.floor(Math.random()*y.length)]}),i(e),f.value="",p.value="",m()}function W(){var o;const e=((o=n.searchKeyword)==null?void 0:o.toLowerCase())||"";if(!e){L.value="";return}const t=(n.studentsByClass[n.currentClass]||[]).find(r=>String(r.id).toLowerCase().includes(e)||String(r.name).toLowerCase().includes(e));L.value=t?t.id:"",t&&ht(()=>{const r=document.querySelector(`.student-card[data-id='${t.id}']`);r&&r.scrollIntoView({behavior:"smooth",block:"center"})})}function i(e){Array.isArray(e)&&(e.sort((s,t)=>t.score-s.score||Number(s.id)-Number(t.id)),e.forEach((s,t)=>s.rank=t+1))}const C={},T={};function A(e,s){var h,u;const t=n.studentsByClass[n.currentClass],o=t.find(d=>d.id===e);if(!o)return;o.score+=s,o.score<0&&(o.score=0),i(t);const r=document.getElementById(`points-${e}`);r&&(r.textContent=`Score: ${o.score}`,r.style.transform="scale(1.5)",setTimeout(()=>r.style.transform="scale(1)",200),s>0&&((h=V.value)==null||h.play()),s<0&&((u=U.value)==null||u.play())),E.activeTab==="number"?(t.forEach(d=>{const c=document.querySelector(`.student-card[data-id='${d.id}']`);c&&(c.querySelector(".rank-label").textContent=d.rank)}),I(e,250)):(I(e,5e3),clearTimeout(T[e]),T[e]=setTimeout(()=>{delete T[e]},5e3)),k(),m()}function Y(e){const s=n.studentsByClass[n.currentClass].find(t=>t.id===e);s&&confirm(`确定要将 ${s.name} 的分数重置为 0 吗？`)&&A(e,-s.score)}function tt(e){const s=n.studentsByClass[n.currentClass].find(t=>t.id===e);s&&confirm(`确定要删除 ${s.name} 吗？此操作无法撤销！`)&&(n.studentsByClass[n.currentClass]=n.studentsByClass[n.currentClass].filter(t=>t.id!==e),i(n.studentsByClass[n.currentClass]),m())}function et(){confirm(`确定要将 ${n.currentClass} 班所有学生的分数重置为 0 吗？此操作不可撤销！`)&&(n.studentsByClass[n.currentClass].forEach(e=>e.score=0),i(n.studentsByClass[n.currentClass]),m())}function st(){const e=JSON.stringify(n.studentsByClass,null,2),s=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(s),o=document.createElement("a");o.href=t,o.download="students_backup.json",o.click(),URL.revokeObjectURL(t),alert("备份成功，已生成 students_backup.json 文件！")}function nt(){var e;(e=w.value)==null||e.click()}function at(e){const s=new FileReader;s.onload=t=>{try{const o=JSON.parse(t.target.result);typeof o=="object"?(n.studentsByClass=o,k(),m(),alert("导入成功！")):alert("JSON 格式不正确！")}catch(o){alert("读取 JSON 出错："+o.message)}},s.readAsText(e)}function ot(e){const s=j.value;s&&(s.textContent=e,s.style.display="block",setTimeout(()=>s.style.display="none",2e3))}function I(e,s=3e3){const t=document.querySelector(`.student-card[data-id='${e}']`);t&&(C[e]&&clearTimeout(C[e]),t.classList.add("highlight"),C[e]=setTimeout(()=>{t.classList.remove("highlight"),delete C[e]},s))}function rt(e){return 1-Math.pow(1-e,2)}let b=!1;function lt(){if(b)return;b=!0;const e=Array.from(document.querySelectorAll(".student-card"));if(!e.length){b=!1;return}const s=3e3;let t=Date.now(),o;function r(){let u=(Date.now()-t)/s;u>1&&(u=1),e.forEach(c=>c.classList.remove("highlight-temp"));const d=Math.floor(Math.random()*e.length);o=e[d],o.classList.add("highlight-temp"),u<1?requestAnimationFrame(()=>{const c=50+rt(u)*100;setTimeout(r,c)}):(e.forEach(c=>c.classList.remove("highlight-temp")),I(o.dataset.id,3e3),o.scrollIntoView({behavior:"smooth",block:"center"}),ot(`恭喜 ${o.querySelector("h3").textContent} 被选中！`),b=!1)}r()}function k(){const e=n.studentsByClass[n.currentClass]||[],t=e.every(r=>r.score===0)?[]:e.slice().sort((r,h)=>h.score-r.score).slice(0,10);M||(M=gt(D.value));const o={title:{text:"积分榜单",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:t.map(r=>r.name),axisLabel:{interval:0}},yAxis:{type:"value",minInterval:1,axisLabel:{formatter:r=>Math.round(r)}},series:[{type:"bar",data:t.map(r=>({value:r.score,itemStyle:{color:r.gender==="男"?"#4a90e2":"#e91e63"}}))}]};M.setOption(o)}return dt(()=>{var s;n.studentsByClass=P();const e=document.getElementById("classSelect");e&&(e.innerHTML="",Object.keys(n.studentsByClass).forEach(t=>{const o=document.createElement("option");o.value=t,o.textContent=t,e.appendChild(o)}),e.value=n.currentClass,e.addEventListener("change",t=>{n.currentClass=t.target.value,i(n.studentsByClass[n.currentClass])})),(s=w.value)==null||s.addEventListener("change",t=>{var r;const o=(r=t.target.files)==null?void 0:r[0];o&&at(o)}),i(n.studentsByClass[n.currentClass]),k()}),ft(()=>g.fullPath,()=>{n.studentsByClass=P(),n.currentClass=Object.keys(n.studentsByClass)[0]||x[0],i(n.studentsByClass[n.currentClass]),k()}),(e,s)=>($(),R("div",yt,[s[7]||(s[7]=a("h2",{style:{"text-align":"center",margin:"0 0 10px"}},"学生积分管理系统",-1)),a("div",Ct,[a("div",{ref_key:"chartRef",ref:D,class:"chart"},null,512)]),a("div",bt,[a("div",kt,[v(a("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>q.value=t),onChange:X,id:"classSelect"},null,544),[[z,q.value]]),v(a("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=t=>F.value=t),placeholder:"Search name/ID",onInput:W,id:"search"},null,544),[[N,F.value,void 0,{trim:!0}]]),s[5]||(s[5]=a("label",null,"Add Student",-1))]),a("div",_t,[v(a("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=t=>f.value=t),placeholder:"Name",id:"name"},null,512),[[N,f.value,void 0,{trim:!0}]]),v(a("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=t=>p.value=t),placeholder:"ID",id:"id"},null,512),[[N,p.value,void 0,{trim:!0}]]),v(a("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>B.value=t),id:"gender"},[...s[6]||(s[6]=[a("option",{value:"男"},"Male",-1),a("option",{value:"女"},"Female",-1)])],512),[[z,B.value]]),a("button",{onClick:Q},"Add")])]),a("div",St,[a("div",xt,[a("input",{type:"file",ref_key:"fileInputRef",ref:w,accept:".json",style:{display:"none"}},null,512),a("button",{onClick:nt},"Import"),a("button",{onClick:st},"Backup"),a("button",{onClick:et},"Reset All Points"),a("button",{class:"action-button",id:"lotteryBtn",onClick:lt},"Random Roll Call"),a("div",{class:"toast",ref_key:"toastRef",ref:j,style:{display:"none",position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,123,255,0.9)",color:"#fff",padding:"15px 25px","border-radius":"8px","font-size":"18px","z-index":"1000"}},"提示",512)])]),a("div",Bt,[a("div",wt,[($(!0),R(pt,null,mt(G.value,t=>($(),R("div",{key:t.id,class:vt(["student-card",[t.gender==="男"?"male":"female",L.value===t.id?"highlight-temp":""]]),"data-id":t.id},[a("div",Mt,S(t.rank||""),1),a("img",{class:"avatar",src:t.avatar},null,8,Tt),a("h3",null,S(t.name),1),a("div",At,[a("span",null,"Number: "+S(t.id),1),a("span",{class:"points",id:`points-${t.id}`},"Score: "+S(t.score),9,It)]),a("div",Rt,[a("button",{class:"add",onClick:o=>A(t.id,1)},"+1",8,Nt),a("button",{class:"sub",onClick:o=>A(t.id,-1)},"-1",8,$t),a("button",{class:"reset",onClick:o=>Y(t.id)},"Reset",8,Et),a("button",{class:"delete",onClick:o=>tt(t.id)},"Delete",8,Ot)])],10,Lt))),128))])]),a("audio",{ref_key:"addAudio",ref:V,src:"https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"},null,512),a("audio",{ref_key:"subAudio",ref:U,src:"https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"},null,512)]))}},qt=it(jt,[["__scopeId","data-v-fa726b38"]]);export{qt as default};
